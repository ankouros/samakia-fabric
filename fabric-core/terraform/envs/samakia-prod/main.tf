###############################################################################
# Samakia Fabric â€“ Production LXC
###############################################################################

module "monitoring_1" {
  source = "../../modules/lxc-container"

  ###########################################################################
  # Identity
  ###########################################################################
  vmid     = 1100
  hostname = "monitoring-1"
  node     = "proxmox1"

  ###########################################################################
  # Template & storage
  ###########################################################################
  # template = "pve-nfs:vztmpl/ubuntu-24.04-lxc-rootfs.tar.gz"
  template    = "pve-nfs:vztmpl/ubuntu-24.04-lxc-rootfs-v4.tar.gz"
  storage     = "pve-nfs"
  bridge      = "vmbr0"
  mac_address = "BC:24:11:AD:49:D4"

  ###########################################################################
  # Resources
  ###########################################################################
  cores       = 2
  memory      = 2048
  swap        = 1024
  rootfs_size = 20

  ###########################################################################
  # Access
  ###########################################################################
  ssh_public_keys = var.ssh_public_keys


  ###########################################################################
  # Metadata
  ###########################################################################
  tags = [
    "fabric",
    "monitoring",
    "prod"
  ]
}

###############################################################################
# Outputs for Ansible inventory
###############################################################################

output "lxc_inventory" {
  description = "Inventory data for Ansible"
  value = {
    monitoring_1 = {
      hostname = module.monitoring_1.hostname
      node     = module.monitoring_1.node
      vmid     = module.monitoring_1.vmid
    }
  }
}
