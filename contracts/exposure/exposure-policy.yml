apiVersion: v1alpha1
kind: ExposurePolicy
metadata:
  name: default
  policy_version: "2026-01-02"
  description: "Default exposure policy (dev/shared allowlisted; prod restricted)."
spec:
  allowlist:
    envs:
      - samakia-dev
      - samakia-shared
      - samakia-prod
    tenants:
      samakia-dev:
        - canary
      samakia-shared:
        - shared-canary
      samakia-prod: []
    workloads:
      canary:
        - sample
      shared-canary:
        - sample
    providers:
      - postgres
      - mariadb
      - rabbitmq
      - dragonfly
      - qdrant
    variants:
      - single
      - cluster
  invariants:
    tls_required: true
    allow_plaintext_endpoints: false
  enforcement:
    prod:
      require_signing: true
      require_change_window: true
      require_approval: true
    non_prod:
      require_signing: false
      require_change_window: false
      require_approval: true
      allow_execute: true
  naming:
    output_format: "YYYYMMDDTHHMMSSZ-<build_id>"
    build_id_source: "env:EXPOSURE_BUILD_ID"
    tag_keys:
      - tenant
      - workload
      - provider
      - variant
      - policy_version
